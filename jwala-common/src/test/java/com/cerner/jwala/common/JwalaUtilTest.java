package com.cerner.jwala.common;

import org.junit.Test;

import static org.junit.Assert.*;

/**
 * Created by Arvindo Kinny on 5/10/2017.
 */
public class JwalaUtilTest {

    @Test
    public void testScrubPassword(){
        String stringHasPassword = "Service JWALA-HOSTNAME-3 not installed on server, continuing with install D:cygwin64home\\myusername>set svc_password=MyPassword Dset svc_username=usmlvv1d0a/N9SFGLabTomcaAdmin D:\\cygwin64\\home\\myusername>set svc_password=MyPassword D:\\cygwin64\\home\\myusername>SET JAVA_HOME=D:\\ctp/jdk1.8.0_92 D:\\cygwin64\\home\\myusername>SET CATALINA_HOME=D:/ctp/app/instances\\JWALA-HOSTNAME-3\\apache-tomcat-7.0.55 set svc_password=MyPassword D D:\\cygwin64\\home\\myusername>svc_username=usmlvv1d0a/N9SFGLabTomcaAdmin DSET TOMCAT_BIN_DIR=D:/ctp/app/instances\\JWALA-HOSTNAME-3\\apache-tomcat-7.0.55\\bin svc_username=usmlvv1d0a/N9SFGLabTomcaAdmin DD:\\cygwin64\\home\\myusername>if exist D:/ctp/app/instances\\JWALA-HOSTNAME-3\\apache-tomcat-7.0.55\\bin\\setenv.bat CALL D:/ctp/app/instances\\JWALA-HOSTNAME-3apache-tomcat-7.0.55binsetenv.bat stp dir not found so setting to default stpDir is D:/ctp Run pre_install.bat Install the service Installing the service 'JWALA-HOSTNAME-3' ... Using CATALINA_HOME: \"D:ctpappinstancesJWALA-HOSTNAME-3apache-tomcat-7.0.55\" Using CATALINA_BASE: \"D:ctpappinstancesJWALA-HOSTNAME-3apache-tomcat-7.0.55\" Using JAVA_HOME: \"D:ctpjdk1.8.0_92\" Using JRE_HOME: \"D:ctpjdk1.8.0_92jre\" Using JVM: \"D:ctpjdk1.8.0_92jrebinserverjvm.dll\" The service 'JWALA-HOSTNAME-3' has been installed. Update Java Options Change the service to automatically start [SC] ChangeServiceConfig SUCCESS Run post_install.bat [SC] ChangeServiceConfig FAILED 1057: The account name is invalid or does not exist, or the password is invalid for the account name specified. Failed to install service JWALA-HOSTNAME-3 ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ echo 'EXIT_CODE='$?*** EXIT_CODE=1*** ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ echo -n -e 'xff' ï¿½]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $";
        assertTrue(JwalaUtil.scrubDomainUserPassword(stringHasPassword).contains(JwalaUtil.INSTALL_SERVICE_PWD_REPLACEMENT));
    }
    
    @Test
    public void testNoScrubPassword(){
        String stringHasNoPassword = "Service JWALA-HOSTNAME-3 not installed on server, continuing with install D:cygwin64home\\myusername>set Dset svc_username=usmlvv1d0a/N9SFGLabTomcaAdmin D:\\cygwin64\\home\\myusername>set  D:\\cygwin64\\home\\myusername>SET JAVA_HOME=D:\\ctp/jdk1.8.0_92 D:\\cygwin64\\home\\myusername>SET CATALINA_HOME=D:/ctp/app/instances\\JWALA-HOSTNAME-3\\apache-tomcat-7.0.55 set  D D:\\cygwin64\\home\\myusername>svc_username=usmlvv1d0a/N9SFGLabTomcaAdmin DSET TOMCAT_BIN_DIR=D:/ctp/app/instances\\JWALA-HOSTNAME-3\\apache-tomcat-7.0.55\\bin svc_username=usmlvv1d0a/N9SFGLabTomcaAdmin DD:\\cygwin64\\home\\myusername>if exist D:/ctp/app/instances\\JWALA-HOSTNAME-3\\apache-tomcat-7.0.55\\bin\\setenv.bat CALL D:/ctp/app/instances\\JWALA-HOSTNAME-3apache-tomcat-7.0.55binsetenv.bat stp dir not found so setting to default stpDir is D:/ctp Run pre_install.bat Install the service Installing the service 'JWALA-HOSTNAME-3' ... Using CATALINA_HOME: \"D:ctpappinstancesJWALA-HOSTNAME-3apache-tomcat-7.0.55\" Using CATALINA_BASE: \"D:ctpappinstancesJWALA-HOSTNAME-3apache-tomcat-7.0.55\" Using JAVA_HOME: \"D:ctpjdk1.8.0_92\" Using JRE_HOME: \"D:ctpjdk1.8.0_92jre\" Using JVM: \"D:ctpjdk1.8.0_92jrebinserverjvm.dll\" The service 'JWALA-HOSTNAME-3' has been installed. Update Java Options Change the service to automatically start [SC] ChangeServiceConfig SUCCESS Run post_install.bat [SC] ChangeServiceConfig FAILED 1057: The account name is invalid or does not exist, or the password is invalid for the account name specified. Failed to install service JWALA-HOSTNAME-3 ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ echo 'EXIT_CODE='$?*** EXIT_CODE=1*** ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ echo -n -e 'xff' ï¿½]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $ ]0;~ [32mmyusername@USMLVV1CDS0049 [33m~[0m $";
        assertFalse(JwalaUtil.scrubDomainUserPassword(stringHasNoPassword).contains(JwalaUtil.INSTALL_SERVICE_PWD_REPLACEMENT));
    }
    @Test
    public void testNoScrubPasswordAgain(){
        String stringHasPassword = "D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>set svc_username=N9SFGLabTomcatAdmin D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>set svc_password=cgxcfdgxdfsdfdsfdsfdsfsdfdsfdsfds D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET JAVA_HOME=c:\\ctp/jdk1.8.0_92 D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET CATALINA_HOME=C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55 D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET TOMCAT_BIN_DIR=C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>if exist C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\setenv.bat CALL C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\setenv.bat D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET JAVA_HOME=C:\\ctp\\jdk1.8.0_92 D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET JRE_HOME=C:\\ctp\\jdk1.8.0_92\\jre D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET CATALINA_HOME=C:\\ctp\\apache-tomcat-7.0.55\\core D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET CATALINA_BASE=C:/ctp/app/instances/USMLVV2CTO0244-hello D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET CATALINA_OPTS=-XX:PermSize=512m -XX:MaxPermSize=512m D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET PROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET STP_OPTS=-DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET STP_PROPERTIES_DIR=C:\\ctp\\app\\properties D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET STP_OPTS=-DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties -DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET LOG_ROOT_DIR=C:/ctp/apache-tomcat-7.0.55/logs D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET LOG_OPTS=-Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET LOG_OPTS=-Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs -Dlog4j.configuration=log4j.xml -Dlog4j.debug=true D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET LOGIN_CONFIG=-Djava.security.auth.login.config=\\jaas.config D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET APR_OPTS=-Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET PROD_OPTS=-Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin -DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties -DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties -XX:PermSize=512m -XX:MaxPermSize=512m -Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs -Dlog4j.configuration=log4j.xml -Dlog4j.debug=true -Djava.security.auth.login.config=\\jaas.config D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET DEBUG_OPTS=-Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin -DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties -DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties -XX:PermSize=512m -XX:MaxPermSize=512m -Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs -Dlog4j.configuration=log4j.xml -Dlog4j.debug=true -Djava.security.auth.login.config=\\jaas.config D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET JAVA_SERVICE_OPTS=-Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin#-DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties#-DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties####-XX:PermSize=512m#-XX:MaxPermSize=512m##-Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs#-Dlog4j.configuration=log4j.xml#-Dlog4j.debug=true#-Djava.security.auth.login.config=\\jaas.config# D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET JAVA_OPTS=-Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin -DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties -DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties -XX:PermSize=512m -XX:MaxPermSize=512m -Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs -Dlog4j.configuration=log4j.xml -Dlog4j.debug=true -Djava.security.auth.login.config=\\jaas.config D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>IF \"0\" NEQ \"0\" (EXIT 0\" ) D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>ECHO Run pre_install.bat Run pre_install.bat D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>if exist C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\pre_install.bat call C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\pre_install.bat D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>IF \"0\" NEQ \"0\" (EXIT 0\" ) D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>ECHO Install the service Install the service D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>CMD /C C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\service.bat install USMLVV2CTO0244-hello The tomcat7.exe was not found... The CATALINA_HOME environment variable is not defined correctly. This environment variable is needed to run this program D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SET SERVICE_OPTS=\"\" D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>IF \"-Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin#-DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties#-DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties####-XX:PermSize=512m#-XX:MaxPermSize=512m##-Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs#-Dlog4j.configuration=log4j.xml#-Dlog4j.debug=true#-Djava.security.auth.login.config=\\jaas.config#\" NEQ \"\" SET SERVICE_OPTS=++JvmOptions -Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin#-DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties#-DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties####-XX:PermSize=512m#-XX:MaxPermSize=512m##-Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs#-Dlog4j.configuration=log4j.xml#-Dlog4j.debug=true#-Djava.security.auth.login.config=\\jaas.config# D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>IF \"\" NEQ \"\" SET SERVICE_OPTS=++JvmOptions -Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin#-DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties#-DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties####-XX:PermSize=512m#-XX:MaxPermSize=512m##-Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs#-Dlog4j.configuration=log4j.xml#-Dlog4j.debug=true#-Djava.security.auth.login.config=\\jaas.config# --StartPath D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>ECHO Update Java Options Update Java Options D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>CMD /C C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\\\tomcat7.exe //US//USMLVV2CTO0244-hello --JavaHome c:\\ctp/jdk1.8.0_92 ++JvmOptions -Djava.library.path=C:\\ctp\\apache-tomcat-7.0.55\\core\\bin#-DPROPERTIES_ROOT_PATH=C:\\ctp\\app\\properties#-DSTP_PROPERTIES_DIR=C:\\ctp\\app\\properties####-XX:PermSize=512m#-XX:MaxPermSize=512m##-Dlog.root.dir=C:/ctp/apache-tomcat-7.0.55/logs#-Dlog4j.configuration=log4j.xml#-Dlog4j.debug=true#-Djava.security.auth.login.config=\\jaas.config# --StdOutput \"\" --StdError \"\" D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>ECHO Change the service to automatically start Change the service to automatically start D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SC CONFIG USMLVV2CTO0244-hello start= auto [SC] ChangeServiceConfig SUCCESS D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>ECHO Run post_install.bat Run post_install.bat D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>if exist C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\post_install.bat call C:/ctp/app/instances\\USMLVV2CTO0244-hello\\apache-tomcat-7.0.55\\bin\\post_install.bat D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>IF \"0\" NEQ \"0\" (EXIT 0\" ) D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>if N9SFGLabTomcatAdmin == \"\" goto :no_user D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>SC CONFIG USMLVV2CTO0244-hello obj=N9SFGLabTomcatAdmin password=cgxcfdgxdfsdfdsfdsfdsfsdfdsfdsfds [SC] ChangeServiceConfig FAILED 1057: The account name is invalid or does not exist, or the password is invalid for the account name specified. D:\\cygwin64\\home\\N9SFGLabTomcatAdmin>EXIT 1057 Failed to install service USMLVV2CTO0244-hello        assertFalse(JwalaUtil.scrubDomainUserPassword(stringHasNoPassword).contains(JwalaUtil.INSTALL_SERVICE_PWD_REPLACEMENT))";
        System.out.println(JwalaUtil.scrubDomainUserPassword(stringHasPassword).contains(JwalaUtil.INSTALL_SERVICE_PWD_REPLACEMENT));
        assertTrue(JwalaUtil.scrubDomainUserPassword(stringHasPassword).contains(JwalaUtil.INSTALL_SERVICE_PWD_REPLACEMENT));
    }

}